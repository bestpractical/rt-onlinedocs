<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" >
<head>
<title><% $n || 'RT' %> - RT Developer Documentation Online</title>
<style type="text/css"><!--
a { text-decoration: none }
a:hover { text-decoration: underline }
a:focus { background: #99ff99; border: 1px black dotted }
--></style>
</head>
<body style="background: #dddddd">
<%PERL>


my $dirname = File::Basename::dirname($INC{'RT.pm'});
my $localdir = $dirname."/../local/lib";
my $plugindir = $dirname."/../local/plugins";
my @plugins = ();
if(opendir(PLUGINS, $plugindir)) {
    while(defined(my $plugin = readdir(PLUGINS))) {
	next if($plugin =~ /^\./);
	push(@plugins, $plugindir."/".$plugin."/lib");
    }
    closedir(PLUGINS);
}
my @found;
File::Find::find(
    { untaint => 1,
      wanted => sub {
        return unless /(\w+)\.(?:pm|pod)$/;
        return if $1 =~ /(?:perllocal|_(?:Local|Vendor|Overlay))/;
        my $name = $File::Find::name;
        $name =~ s/.*lib\b.//;
        $name =~ s!\.(?:pm|pod)!!i;
        $name =~ s!\W!::!g;
        push @found, $name;
    },follow => ($^O ne 'MSWin32') },
    $dirname,$localdir,@plugins
);
my ($prev, $indent);
foreach my $file (sort @found) {
    my ($parent, $name) = ($1, $2) if $file =~ /(?:(.*)::)?(\w+)$/;
    if ($file =~ /^$prev\::(.*)/) {
        my $foo = $1;
        while ($foo =~ s/(\w+):://) {
            $indent++;
            $m->print(('&nbsp;&nbsp;&nbsp;' x $indent));
            $m->print("$1<br />");
        }
        $indent++;
    } elsif ($prev !~ /^$parent\::/) {
        while ($parent =~ s/(\w+)//) {
            next if $prev =~ s/\b$1:://;
            while ($prev =~ s/:://) {
                $indent--;
            }
            $m->print(('&nbsp;&nbsp;&nbsp;' x $indent));
            $m->print("$1<br />");
            $indent++;
        }
    } elsif ($prev =~ /^$parent\::(.*::)/) {
        my $foo = $1;
        while ($foo =~ s/:://) {
            $indent--;
        }
    }
    $m->print( ( '&nbsp;&nbsp;&nbsp;' x $indent )
      . '<a target="podBody" href="Body.html?n=' . $file . '">' . $name
      . '</a><br />' ."\n" );
    $prev = $file;
}

</%PERL>
</body></html>
<%INIT>
require File::Basename;
require File::Find;
require File::Temp;
require File::Spec;
require Pod::Simple::HTML;
</%INIT>
<%ARGS>
$n  => ''
$method => ''
$Target    => '&method=Body'
</%ARGS>
